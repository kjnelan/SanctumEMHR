import{r as n,u as v,j as e,N as p,t as l}from"./index-BneZRaVW.js";import{h as g,i as N}from"./PortalService-CisPuOln.js";const c=n.createContext(null);function w(){const s=n.useContext(c);if(!s)throw new Error("usePortalAuthContext must be used within PortalAuthProvider");return s}function j(){const s=v(),[t,o]=n.useState(null),[i,x]=n.useState(!0);return n.useEffect(()=>{async function m(){try{if(!localStorage.getItem("portalClient")){s("/mycare/login");return}const a=await g();a&&a.id?o({id:a.id,firstName:a.firstName,lastName:a.lastName,fullName:a.fullName,email:a.email,phone:a.phone,dateOfBirth:a.dateOfBirth,providerName:a.providerName,forcePasswordChange:a.forcePasswordChange,initials:(a.firstName?.[0]||"")+(a.lastName?.[0]||"")}):(localStorage.removeItem("portalClient"),s("/mycare/login"))}catch(r){console.log("Portal session check failed:",r.message),localStorage.removeItem("portalClient"),s("/mycare/login")}finally{x(!1)}}m()},[]),{client:t,loading:i}}function P({children:s}){const{client:t,loading:o}=j(),[i,x]=n.useState(0),m=n.useRef(!1),r={client:t,loading:o};if(o)return e.jsx(c.Provider,{value:r,children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-mental",children:e.jsxs("div",{className:"sanctum-glass-main p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto",style:{border:"3px solid rgba(107, 154, 196, 0.3)",borderTopColor:"rgba(107, 154, 196, 0.9)"}}),e.jsx("p",{className:"text-label mt-4 text-center",children:"Loading..."})]})})});if(!t)return e.jsx(c.Provider,{value:r,children:null});if(t.forcePasswordChange)return e.jsx(c.Provider,{value:r,children:e.jsx(p,{to:"/mycare/change-password",replace:!0})});const a=window.location.hash?.replace("#/mycare/","")||"dashboard";return n.useEffect(()=>{if(m.current)return;m.current=!0;const h=async()=>{try{const d=await fetch("/custom/api/portal/messages/get_unread_count.php",{credentials:"include"});if(d.ok){const u=await d.json();u.success&&x(u.unreadCount||0)}}catch(d){console.error("Failed to fetch unread count:",d)}};h();const f=setInterval(h,3e4);return()=>clearInterval(f)},[]),e.jsx(c.Provider,{value:r,children:e.jsxs("div",{className:"min-h-screen bg-gradient-mental",children:[e.jsx("nav",{className:"sticky top-0 z-50 px-4 py-3",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"sanctum-glass-main px-6 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.logoUrl?e.jsx("img",{src:l.logoUrl,alt:l.companyName,className:"h-8 w-auto"}):e.jsx("span",{className:"text-xl font-bold text-gray-800",children:l.logoText}),e.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"Client Portal"})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[e.jsx("a",{href:"#/mycare/dashboard",className:a==="dashboard"?"nav-main-active":"nav-main-inactive",children:"Dashboard"}),e.jsx("a",{href:"#/mycare/appointments",className:a==="appointments"?"nav-main-active":"nav-main-inactive",children:"Appointments"}),e.jsxs("a",{href:"#/mycare/messages",className:`relative ${a==="messages"?"nav-main-active":"nav-main-inactive"}`,children:["Messages",i>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:i>99?"99+":i})]}),e.jsx("a",{href:"#/mycare/profile",className:a==="profile"?"nav-main-active":"nav-main-inactive",children:"My Profile"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:t.fullName}),t.providerName&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Provider: ",t.providerName]})]}),e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-sm font-bold",children:t.initials}),e.jsx("button",{onClick:N,className:"text-sm text-gray-600 hover:text-gray-800 font-medium",children:"Sign Out"})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-1 mt-3 pt-3 border-t border-white/30",children:[e.jsx("a",{href:"#/mycare/dashboard",className:`flex-1 text-center text-sm py-2 rounded-lg font-semibold ${a==="dashboard"?"nav-main-active":"nav-main-inactive"}`,children:"Dashboard"}),e.jsx("a",{href:"#/mycare/appointments",className:`flex-1 text-center text-sm py-2 rounded-lg font-semibold ${a==="appointments"?"nav-main-active":"nav-main-inactive"}`,children:"Appointments"}),e.jsx("a",{href:"#/mycare/messages",className:`flex-1 text-center text-sm py-2 rounded-lg font-semibold ${a==="messages"?"nav-main-active":"nav-main-inactive"}`,children:"Messages"}),e.jsx("a",{href:"#/mycare/profile",className:`flex-1 text-center text-sm py-2 rounded-lg font-semibold ${a==="profile"?"nav-main-active":"nav-main-inactive"}`,children:"Profile"})]})]})})}),e.jsx("main",{className:"max-w-6xl mx-auto px-4 py-6",children:s}),e.jsx("footer",{className:"text-center py-6",children:e.jsxs("p",{className:"text-gray-500 text-xs",children:["Â© ",new Date().getFullYear()," ",l.companyName,". All rights reserved."]})})]})})}export{P,w as u};
