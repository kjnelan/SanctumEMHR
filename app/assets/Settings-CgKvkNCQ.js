import{n as oe,r,j as e,E as ce,F as g,R as A,H as de,I as ue,J as me,C as xe,K as pe,a as ge,z as he,P as fe}from"./index-BneZRaVW.js";import{r as ve}from"./index-mWt39q-I.js";function be({isOpen:d,onClose:I,onSave:h,initialDate:m,initialTime:T,categories:y,block:l}){const{user:O}=oe(),[S,f]=r.useState(!1),[z,n]=r.useState(null),[L,k]=r.useState(null),[P,p]=r.useState(null),[a,v]=r.useState(""),[x,$]=r.useState(m||new Date().toISOString().split("T")[0]),[w,V]=r.useState(T||"09:00"),[F,ae]=r.useState(""),[K,H]=r.useState(50),[Y,G]=r.useState(""),[W,Z]=r.useState(!1),[B,ee]=r.useState({mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1}),[U,q]=r.useState("1"),[D,Q]=r.useState("count"),[M,te]=r.useState(10),[X,t]=r.useState(""),[i,c]=r.useState(!1),[u,o]=r.useState("single"),[j,C]=r.useState(null),R=[30,50,90,240,480];r.useEffect(()=>{m&&$(m),T&&V(T)},[m,T]),r.useEffect(()=>{l&&d&&(v(l.categoryId||""),$(l.eventDate||""),V(l.startTime?l.startTime.substring(0,5):""),H(l.duration||50),G(l.comments||""),l.isRecurring&&l.recurrenceId?(c(!0),C(l.recurrenceId),o("single")):(c(!1),C(null)))},[l,d]),r.useEffect(()=>{y&&y.length>0&&!a&&(v(y[0].id),y[0].defaultDuration>0&&H(y[0].defaultDuration/60))},[y]),r.useEffect(()=>{if(w&&F){const[s,N]=w.split(":").map(Number),[b,E]=F.split(":").map(Number),se=s*60+N,ie=b*60+E-se;ie>0&&H(ie)}},[w,F]);const J=async(s,N=!1)=>{if(s.preventDefault(),f(!0),n(null),k(null),p(null),!a){n("Please select an availability type"),f(!1);return}if(W){if(Object.values(B).filter(Boolean).length===0){n("Please select at least one day for recurrence"),f(!1);return}if(D==="date"&&!X){n("Please select an end date for recurrence"),f(!1);return}if(D==="count"&&(!M||M<1)){n("Please enter a valid number of occurrences"),f(!1);return}}try{const b=w.includes(":")?`${w}:00`:`${w}:00:00`,E={clientId:null,providerId:O.id,categoryId:parseInt(a),eventDate:x,startTime:b,duration:parseInt(K),title:y.find(ne=>ne.id===parseInt(a))?.name||"Blocked",comments:Y,room:"",apptstatus:l?l.apptstatus:"-",overrideAvailability:N};i&&(E.seriesUpdate={scope:u,recurrenceId:j}),W&&!l&&(E.recurrence={enabled:!0,days:B,interval:parseInt(U),endType:D,endCount:D==="count"?parseInt(M):null,endDate:D==="date"?X:null}),console.log(l?"Updating availability block:":"Creating availability block:",E);const se=l?await de(l.id,E):await ue(E);se.success?(k(l?"Availability updated successfully!":"Availability saved successfully!"),setTimeout(()=>{_()},1e3)):n(se.message||`Failed to ${l?"update":"create"} block`)}catch(b){console.error(`Failed to ${l?"update":"create"} block:`,b),b.conflicts?p({conflicts:b.conflicts,totalOccurrences:b.totalOccurrences,conflictCount:b.conflictCount}):n(b.message||`Failed to ${l?"update":"create"} block`)}finally{f(!1)}},re=()=>{p(null),J({preventDefault:()=>{}},!0)},le=async()=>{if(!l)return;let s="Are you sure you want to delete this availability entry?";if(i&&(u==="all"?s="Are you sure you want to delete ALL occurrences in this recurring series?":u==="future"&&(s="Are you sure you want to delete this and all future occurrences?")),!!confirm(s)){f(!0),n(null),k(null);try{const N=i?{scope:u,recurrenceId:j}:null,b=await me(l.id,N);if(b.success){const E=i&&u!=="single"?`${b.deletedCount||"Multiple"} entries deleted successfully!`:"Availability deleted successfully!";k(E),setTimeout(()=>{_()},1e3)}else n(b.message||"Failed to delete block")}catch(N){console.error("Failed to delete block:",N),n(N.message||"Failed to delete block")}finally{f(!1)}}},_=()=>{v(""),G(""),n(null),k(null),p(null),Z(!1),ee({mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1}),q("1"),Q("count"),te(10),t(""),c(!1),o("single"),C(null),I(),h&&h()};return d?ve.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/60 backdrop-blur-md transition-opacity",onClick:_,"aria-hidden":"true"}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-y-auto",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",maxWidth:"48rem",maxHeight:"90vh",zIndex:10},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-200 px-8 pt-6 bg-gradient-to-r from-purple-50 to-pink-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:l?"Edit Availability":"Add Availability"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l?"Update or remove this availability entry":"Define when you are available or unavailable"})]}),e.jsx("button",{onClick:_,className:"p-2 hover:bg-white/80 rounded-xl transition-all hover:scale-110",disabled:S,children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"px-8 pb-8",children:[P&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-700 font-bold mb-2",children:"Scheduling Conflicts Detected"}),e.jsxs("p",{className:"text-red-600 text-sm mb-3",children:[P.conflictCount," of ",P.totalOccurrences," recurring blocks have conflicts:"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto mb-4 space-y-2",children:P.conflicts.map((s,N)=>e.jsxs("div",{className:"bg-white border border-red-200 rounded p-2 text-sm",children:[e.jsxs("div",{className:"font-medium text-red-700",children:[new Date(s.date).toLocaleDateString()," at ",s.time]}),e.jsx("div",{className:"text-red-600",children:s.reason})]},N))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:re,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Create Anyway (Skip Conflicts)"}),e.jsx("button",{type:"button",onClick:()=>p(null),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-medium rounded-lg transition-colors",children:"Cancel"})]})]})]})}),z&&e.jsxs(ce,{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("span",{children:z})]}),L&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg text-green-700 flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:L})]}),i&&e.jsx("div",{className:"mb-6 p-4 bg-purple-50 border-l-4 border-purple-500 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 mt-0.5 flex-shrink-0 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-purple-700 font-medium mb-2",children:"Recurring Availability Series"}),e.jsx("p",{className:"text-purple-600 text-sm mb-3",children:"This is part of a recurring series. Choose what to update:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"seriesScope",value:"single",checked:u==="single",onChange:s=>o(s.target.value),className:"text-purple-600 focus:ring-purple-500"}),e.jsxs("span",{className:"text-sm text-purple-700",children:["Just this occurrence (",new Date(x).toLocaleDateString(),")"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"seriesScope",value:"future",checked:u==="future",onChange:s=>o(s.target.value),className:"text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-purple-700",children:"This and all future occurrences"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"seriesScope",value:"all",checked:u==="all",onChange:s=>o(s.target.value),className:"text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-purple-700",children:"All occurrences in the series"})]})]})]})]})}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(g,{children:["Reason ",e.jsx(A,{})]}),e.jsxs("select",{value:a,onChange:s=>v(s.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",required:!0,children:[e.jsx("option",{value:"",children:"Select Reason"}),y.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Date ",e.jsx(A,{})]}),e.jsx("input",{type:"date",value:x,onChange:s=>$(s.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{children:["Start Time ",e.jsx(A,{})]}),e.jsx("input",{type:"time",value:w,onChange:s=>V(s.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{children:"End Time"}),e.jsx("input",{type:"time",value:F,onChange:s=>ae(s.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white"})]})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Duration (minutes) ",e.jsx(A,{})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:[R.map(s=>e.jsx("button",{type:"button",onClick:()=>H(s),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${K===s?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s>=60?`${s/60}h`:`${s}m`},s)),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(12-hours = 720 minutes)"})]}),e.jsx("input",{type:"number",value:K,onChange:s=>H(s.target.value),min:"5",step:"5",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",required:!0})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6 mt-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:s=>Z(s.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),"Make this recurring"]})}),W&&e.jsxs("div",{className:"space-y-4 pl-6 border-l-2 border-purple-200",children:[e.jsxs("div",{children:[e.jsxs(g,{children:["Repeat on ",e.jsx(A,{})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"sun",label:"Sun"},{key:"mon",label:"Mon"},{key:"tue",label:"Tue"},{key:"wed",label:"Wed"},{key:"thu",label:"Thu"},{key:"fri",label:"Fri"},{key:"sat",label:"Sat"}].map(s=>e.jsx("button",{type:"button",onClick:()=>ee(N=>({...N,[s.key]:!N[s.key]})),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${B[s.key]?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.label},s.key))})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Frequency ",e.jsx(A,{})]}),e.jsxs("select",{value:U,onChange:s=>q(s.target.value),className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white",children:[e.jsx("option",{value:"1",children:"Weekly"}),e.jsx("option",{value:"2",children:"Every 2 weeks"}),e.jsx("option",{value:"3",children:"Every 3 weeks"}),e.jsx("option",{value:"4",children:"Every 4 weeks"})]})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Ends ",e.jsx(A,{})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:D==="count",onChange:()=>Q("count"),className:"text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"checkbox-label",children:"After"}),e.jsx("input",{type:"number",value:M,onChange:s=>te(parseInt(s.target.value)||1),disabled:D!=="count",min:"1",max:"52",className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm disabled:bg-gray-100 focus:ring-2 focus:ring-purple-500"}),e.jsx("span",{className:"checkbox-label",children:"occurrences"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:D==="date",onChange:()=>Q("date"),className:"text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"checkbox-label",children:"On"}),e.jsx("input",{type:"date",value:X,onChange:s=>t(s.target.value),disabled:D!=="date",className:"px-2 py-1 border border-gray-300 rounded text-sm disabled:bg-gray-100 focus:ring-2 focus:ring-purple-500"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Notes (Optional)"}),e.jsx("textarea",{value:Y,onChange:s=>G(s.target.value),rows:3,placeholder:"Add any notes about this availability entry...",className:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white"})]}),e.jsxs("div",{className:"flex gap-4 pt-6 mt-6 border-t border-gray-200",children:[l&&e.jsx("button",{type:"button",onClick:le,className:"px-6 py-3 bg-red-100 hover:bg-red-200 text-red-700 font-semibold rounded-xl transition-all hover:shadow-md",disabled:S,children:"Delete"}),e.jsx("button",{type:"button",onClick:_,className:"flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-label rounded-xl transition-all hover:shadow-md",disabled:S,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",disabled:S,children:S?l?"Updating...":"Saving...":l?"Update Availability":"Save Availability"})]})]})]})]})]}),document.body):null}function ye(){const[d,I]=r.useState(new Date),[h,m]=r.useState("week"),[T,y]=r.useState([]),[l,O]=r.useState([]),[S,f]=r.useState(!0),[z,n]=r.useState(!1),[L,k]=r.useState(null),[P,p]=r.useState(null),[a,v]=r.useState({startHour:8,endHour:17,interval:15});r.useEffect(()=>{x(),$()},[]),r.useEffect(()=>{w()},[d,h]);const x=async()=>{try{const t=await xe();t.settings&&v({startHour:t.settings.startHour||8,endHour:t.settings.endHour||17,interval:t.settings.interval||15})}catch(t){console.error("Failed to load calendar settings:",t)}},$=async()=>{try{const t=await pe(null,"client");O(t.categories||[])}catch(t){console.error("Failed to load availability categories:",t)}},w=async()=>{f(!0);try{const t=ge();if(console.log("[CalendarAvailability] Current user:",t),!t||!t.id){console.error("No current user found"),y([]),f(!1);return}const{startDate:i,endDate:c}=V();console.log("[CalendarAvailability] Date range:",{startDate:i,endDate:c}),console.log("[CalendarAvailability] Fetching for provider ID:",t.id);const u=await he(i,c,"all");console.log("[CalendarAvailability] API response:",u),console.log("[CalendarAvailability] Total appointments:",u.appointments?.length);const o=u.appointments.filter(j=>{const C=j.categoryType!=="client",R=j.providerId==t.id;return console.log("[CalendarAvailability] Checking appointment:",{id:j.id,categoryType:j.categoryType,providerId:j.providerId,currentUserId:t.id,isAvailabilityBlock:C,isCurrentProvider:R}),C&&R});console.log("[CalendarAvailability] Filtered blocks:",o),y(o)}catch(t){console.error("Failed to load availability blocks:",t)}finally{f(!1)}},V=()=>{const t=new Date(d),i=new Date(d);if(h==="week"){const c=t.getDay(),u=t.getDate()-c;t.setDate(u),t.setHours(0,0,0,0),i.setDate(t.getDate()+6),i.setHours(23,59,59,999)}else h==="day"&&(t.setHours(0,0,0,0),i.setHours(23,59,59,999));return{startDate:t.toISOString().split("T")[0],endDate:i.toISOString().split("T")[0]}},F=()=>{const t=new Date(d),i=t.getDay(),c=t.getDate()-i;return t.setDate(c),t.setHours(0,0,0,0),Array.from({length:7},(u,o)=>new Date(t.getTime()+o*24*60*60*1e3))},ae=(t,i,c)=>{const u=t.toISOString().split("T")[0],o=`${i.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`;p(null),k({date:u,time:o}),n(!0)},K=(t,i)=>{i.stopPropagation(),p(t),k(null),n(!0)},H=()=>{n(!1),p(null),w()},Y=()=>{const t=new Date(d);h==="week"?t.setDate(t.getDate()-7):t.setDate(t.getDate()-1),I(t)},G=()=>{const t=new Date(d);h==="week"?t.setDate(t.getDate()+7):t.setDate(t.getDate()+1),I(t)},W=()=>{I(new Date)},Z=()=>{if(h==="week"){const t=F(),i=t[0],c=t[6];return`${i.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${c.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}else return d.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})},{startHour:B,endHour:ee,interval:U}=a,q=60/U,Q=(ee-B)*q,M=Array.from({length:Q},(t,i)=>{const c=Math.floor(i/q)+B,u=i%q*U;return{hour:c,minutes:u}}),te=t=>{const[i,c]=t.startTime.split(":").map(Number),u=i*60+c,o=B*60,C=(u-o)/U,R=60,J=C*R,_=(t.duration||0)/U*R;return{top:J,height:_}},X=t=>{const i=t.toISOString().split("T")[0];return T.filter(c=>c.eventDate===i)};return e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Manage My Availability"}),e.jsx("p",{className:"text-gray-600",children:"Set your availability for vacation, meetings, lunch breaks, in-office hours, and more"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:Y,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:G,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("button",{onClick:W,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors",children:"Today"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:Z()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m("day"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${h==="day"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Day"}),e.jsx("button",{onClick:()=>m("week"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${h==="week"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Week"})]})]}),S?e.jsx("div",{className:"text-center py-12 text-gray-600",children:"Loading..."}):e.jsx("div",{className:"bg-white rounded-lg overflow-hidden border border-gray-200",children:h==="week"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("div",{className:"w-20 p-4 bg-gray-50 border-r border-gray-200 font-semibold text-gray-700 flex-shrink-0",children:"Time"}),F().map((t,i)=>{const c=t.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`flex-1 p-4 border-r border-gray-200 text-center ${c?"bg-blue-50":"bg-gray-50"}`,children:[e.jsx("div",{className:"text-sm text-gray-600",children:t.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:`text-lg font-semibold ${c?"text-blue-600":"text-gray-900"}`,children:t.getDate()})]},i)})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-20 flex-shrink-0 border-r border-gray-200 bg-gray-50",children:M.map(t=>e.jsxs("div",{className:"h-[60px] p-3 border-b border-gray-200 text-sm text-gray-700 font-medium",children:[t.hour===0?"12":t.hour<12?t.hour:t.hour===12?"12":t.hour-12,":",t.minutes.toString().padStart(2,"0")," ",t.hour<12?"AM":"PM"]},`time-${t.hour}-${t.minutes}`))}),e.jsx("div",{className:"flex-1 flex",children:F().map((t,i)=>{const c=X(t),u=M.length*60;return e.jsxs("div",{className:"flex-1 border-r border-gray-200 relative",style:{height:`${u}px`},children:[M.map(o=>e.jsx("div",{onClick:()=>ae(t,o.hour,o.minutes),className:"absolute w-full h-[60px] border-b border-gray-200 hover:bg-blue-50 cursor-pointer transition-colors",style:{top:`${M.findIndex(j=>j.hour===o.hour&&j.minutes===o.minutes)*60}px`}},`slot-${o.hour}-${o.minutes}`)),c.map(o=>{const{top:j,height:C}=te(o),R=o.categoryColor||"#9CA3AF";return e.jsxs("div",{onClick:J=>K(o,J),className:"availability-block-card absolute left-1 right-1 px-2 py-1 rounded-lg text-xs z-10 overflow-hidden",style:{"--block-color":R,top:`${j}px`,height:`${C}px`},children:[e.jsx("div",{className:"font-semibold text-gray-800",children:o.categoryName}),C>30&&o.comments&&e.jsx("div",{className:"text-gray-600 text-[10px] truncate",children:o.comments})]},o.id)})]},i)})})]})]})}),e.jsx(be,{isOpen:z,onClose:()=>n(!1),onSave:H,initialDate:L?.date,initialTime:L?.time,categories:l,block:P})]})}function je(){const{user:d}=oe(),[I,h]=r.useState(!0),[m,T]=r.useState(!1),[y,l]=r.useState(null),[O,S]=r.useState(null),[f,z]=r.useState([]),[n,L]=r.useState({fname:"",mname:"",lname:"",title:"",suffix:"",email:"",phone:"",phonecell:"",state_license_number:"",npi:""});r.useEffect(()=>{d?.id&&k()},[d?.id]);const k=async()=>{try{h(!0),l(null);const a=await fetch(`/custom/api/users.php?action=get&id=${d.id}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to load profile");const x=(await a.json()).user;x&&L({fname:x.fname||"",mname:x.mname||"",lname:x.lname||"",title:x.title||"",suffix:x.suffix||"",email:x.email||"",phone:x.phone||"",phonecell:x.phonecell||"",state_license_number:x.state_license_number||"",npi:x.npi||""});const $=await fetch(`/custom/api/users.php?action=user_supervisors&id=${d.id}`,{credentials:"include"});if($.ok){const w=await $.json();z(w.supervisors||[])}}catch(a){console.error("Error loading profile:",a),l(a.message)}finally{h(!1)}},P=async()=>{if(!n.fname||!n.lname||!n.email){l("First name, last name, and email are required");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)){l("Please enter a valid email address");return}try{T(!0),l(null),S(null);const v=await fetch("/custom/api/users.php?action=update_profile",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:d.id,...n})}),x=await v.json();if(!v.ok)throw new Error(x.error||"Failed to save profile");S("Profile updated successfully"),setTimeout(()=>S(null),3e3)}catch(v){console.error("Error saving profile:",v),l(v.message)}finally{T(!1)}},p=(a,v)=>{L(x=>({...x,[a]:v}))};return I?e.jsx("div",{className:"glass-card p-8",children:e.jsx("div",{className:"text-center text-gray-600",children:"Loading profile..."})}):e.jsxs("div",{className:"space-y-6",children:[f.length>0&&e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["My Supervisor",f.length>1?"s":""]}),e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:[a.fname?.charAt(0),a.lname?.charAt(0)]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:[a.fname," ",a.lname,a.title&&e.jsxs("span",{className:"text-gray-600 font-normal ml-1",children:["(",a.title,")"]})]}),a.email&&e.jsx("div",{className:"text-sm text-gray-600",children:a.email}),(a.phone||a.phonecell)&&e.jsx("div",{className:"text-sm text-gray-600",children:a.phonecell||a.phone})]})]},a.id))})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Personal Information"}),y&&e.jsx(ce,{className:"mb-4",children:y}),O&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700",children:O}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{children:["First Name ",e.jsx(A,{})]}),e.jsx("input",{type:"text",value:n.fname,onChange:a=>p("fname",a.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Middle Name"}),e.jsx("input",{type:"text",value:n.mname,onChange:a=>p("mname",a.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs(g,{children:["Last Name ",e.jsx(A,{})]}),e.jsx("input",{type:"text",value:n.lname,onChange:a=>p("lname",a.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Professional Credentials"}),e.jsx("input",{type:"text",value:n.title,onChange:a=>p("title",a.target.value),placeholder:"LCSW, PhD, LPC, etc.",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Suffix"}),e.jsx("input",{type:"text",value:n.suffix,onChange:a=>p("suffix",a.target.value),placeholder:"Jr., Sr., III, etc.",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"State License Number"}),e.jsx("input",{type:"text",value:n.state_license_number,onChange:a=>p("state_license_number",a.target.value),className:"input-field"})]})]})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(g,{children:["Email ",e.jsx(A,{})]}),e.jsx("input",{type:"email",value:n.email,onChange:a=>p("email",a.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Office Phone"}),e.jsx("input",{type:"tel",value:n.phone,onChange:a=>p("phone",a.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx(g,{children:"Cell Phone"}),e.jsx("input",{type:"tel",value:n.phonecell,onChange:a=>p("phonecell",a.target.value),className:"input-field"})]})]})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Professional Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Contact your administrator to update NPI or billing information."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(g,{children:"NPI"}),e.jsx("input",{type:"text",value:n.npi,disabled:!0,className:"input-field bg-gray-100 cursor-not-allowed"})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(fe,{onClick:P,disabled:m,children:m?"Saving...":"Save Changes"})})]})}function Se(){const[d,I]=r.useState("profile"),h=[{id:"profile",label:"My Profile",available:!0},{id:"preferences",label:"Preferences",available:!1},{id:"calendar-settings",label:"Calendar Settings",available:!1},{id:"availability",label:"Calendar Availability",available:!0},{id:"notifications",label:"Notifications",available:!1}];return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"glass-card p-6 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Settings"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your personal preferences and availability"})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-64 flex-shrink-0",children:e.jsx("div",{className:"glass-card p-4",children:e.jsx("nav",{className:"space-y-1",children:h.map(m=>e.jsxs("button",{onClick:()=>m.available&&I(m.id),disabled:!m.available,className:`w-full text-left px-4 py-2 rounded-lg transition-colors ${d===m.id?"bg-blue-600 text-white font-medium":m.available?"hover:bg-gray-100 text-gray-700":"text-gray-400 cursor-not-allowed"}`,children:[m.label,!m.available&&e.jsx("span",{className:"text-xs ml-2",children:"(Coming Soon)"})]},m.id))})})}),e.jsxs("div",{className:"flex-1",children:[d==="profile"&&e.jsx(je,{}),d==="availability"&&e.jsx(ye,{}),d!=="availability"&&d!=="profile"&&e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx("div",{className:"text-gray-700 text-lg font-semibold",children:h.find(m=>m.id===d)?.label}),e.jsx("p",{className:"text-gray-600 mt-2",children:"This section is coming soon"})]})]})]})]})}export{Se as default};
