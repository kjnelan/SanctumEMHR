const a="/custom/api/portal";async function r(e,n={}){const t=await fetch(`${a}${e}`,{...n,credentials:"include",headers:{"Content-Type":"application/json",...n.headers}}),o=await t.json();if(!t.ok)throw t.status===401?(localStorage.removeItem("portalClient"),window.location.href="/app/#/mycare/login",new Error("Session expired")):new Error(o.message||o.error||"Request failed");return o}async function i(e,n){const t=await fetch(`${a}/login.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:n})}),o=await t.json();if(!t.ok)throw new Error(o.message||o.error||"Login failed");return o.success&&o.client&&localStorage.setItem("portalClient",JSON.stringify(o.client)),o}async function c(){return r("/session.php")}async function p(){try{await fetch(`${a}/logout.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(e){console.error("Portal logout error:",e)}finally{localStorage.removeItem("portalClient"),window.location.href="/app/#/mycare/login"}}async function l(e,n){return r("/session.php",{method:"POST",body:JSON.stringify({new_password:e,confirm_password:n})})}async function d(){return r("/profile.php")}async function f(e){return r("/profile.php",{method:"PUT",body:JSON.stringify(e)})}async function h(e="upcoming"){return r(`/appointments.php?view=${e}`)}async function u(e,n,t){const o=await fetch(`${a}/admin_manage.php`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e,portal_username:n,temporary_password:t})}),s=await o.json();if(!o.ok)throw new Error(s.error||"Failed to enable portal access");return s}async function w(e,n){const t=await fetch(`${a}/admin_manage.php`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e,temporary_password:n})}),o=await t.json();if(!t.ok)throw new Error(o.error||"Failed to reset password");return o}async function y(e){const n=await fetch(`${a}/admin_manage.php`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e})}),t=await n.json();if(!n.ok)throw new Error(t.error||"Failed to revoke access");return t}export{w as a,u as b,i as c,l as d,h as e,d as f,f as g,c as h,p as i,y as p};
